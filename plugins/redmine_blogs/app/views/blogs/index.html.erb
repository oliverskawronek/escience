<% if @project %>
<% content_for :sidebar_right do %>
  <% if authorize_for "blogs", "new", true %>
      <%= link_to l(:label_post_new),
                  { :controller => 'blogs',
                    :action => 'new',
                    :project_id => @project,
                    :global => true },
                  :class => 'icon icon-add' %>
  <% end %> 

<!--    
    <% @blog_users = Blog.find(:all, :conditions => ["project_id = ?", @project]).collect{|b| b.author}.uniq.sort %>
    <% if @blog_users.any? %>
      <div class="box">
        <h3 class="icon22 icon22-users"><%=l(:label_users_blogs)%></h3>
      <table class="blogs list">
      <tbody>
        <% @blog_users.each do |user| %>
          <% if user.status == 1 %>
        <tr><td width="32"><%= avatar user, :size => 32 %></td><td><%= link_to h(user.name), :controller => 'blogs', :action => 'index', :author => user, :project_id => @project %></td></tr>
          <% end %>
        <% end %>
      </tbody>
      </table>
      </div>
    <% end %>
-->
    <div class="box">
      <h4><%=l(:label_tag_cloud)%></h4>
      <%= render :partial => 'tag_cloud', :locals => {:tag_counts => Blog.tag_counts} %>
    </div>
<% end %>

<div id="add-blog" style="display:none;">
  <%= render :partial => 'post' %>
</div>
<% end %>

<h2><%=l(:label_blog_plural)%></h2>

<div>
<%= render :partial => 'list', :locals => {:blogs => @blogs} %>
<p class="pagination"><%= pagination_links_full @blogs_pages %></p>

<% other_formats_links do |f| %>
  <%= f.link_to 'Atom', :url => { :action => 'index', :project_id => @project, :key => User.current.rss_key } %>
  <%= f.link_to 'RSS', :url => { :action => 'index', :project_id => @project, :key => User.current.rss_key } %>
<% end if @project %>

</div>

<% html_title(@user ? @user : @tag ? @tag : l(:label_blog_plural)) -%>
