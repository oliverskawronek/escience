<% sorted_users = {}
   @allusers.each do |user| 
     if (sorted_users[user.lastname[0,1]].nil?)
       sorted_users[user.lastname[0,1]] = [user]
     else
       sorted_users[user.lastname[0,1]] = sorted_users[user.lastname[0,1]][0],user
     end
   end
   sorted_users = sorted_users.sort { |a,b| b[1] <=> a[1] }
%>
   
<table>
<% sorted_users.each do |letter, users| %>
  <tr><td><%= letter %></td></tr>
  <% users.each do |user| %>
    <tr>
      <td>
    <% link_to (:controller => 'users', :action => 'show', :id => user.id) do %>
      <%= (!user.salutation.empty?) ? l("field_salutation_vals.#{user.salutation}")+" " : "" %>
      <%= (!user.title.empty?) ? l("field_title_vals.#{user.title}") : "" %>
      <%= user.name %>
    <% end %>
      </td>    
      <td>
        <div class="sendMessage"><%= self.link_to("go", {:controller => 'user_messages', :action => 'new', :id => user.id}) %></div>
      </td>
    </tr>
  <% end %>
<% end %>
</table>