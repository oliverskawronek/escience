<% javascriptString = "" %>
<div class="attachments">
<% for attachment in attachments %>
<div class="attachement">
  <% mimetype = Redmine::MimeType.main_mimetype_of(attachment.filename) 
     filetype = attachment.filename[(attachment.filename.rindex('.')+1)..-1] %>
  <% if filetype == 'pdf' %>
    <%= link_to attachment.filename.to_s(), '#showPDF', :class => 'fancybox '+filetype+' '+mimetype, :target => '_self', :rel=> 'group', :id=>'fileinfo_'+attachment.id.to_s, :onclick => 'new PDFObject({ url: "'+ url_for(attachment).to_s()+'/'+attachment.filename.to_s() +'"}).embed("showPDF");', :title => attachment.description.blank? ? attachment.filename : attachment.description -%>
  <% else %>
    <%= link_to_attachment attachment, :class => 'fancybox '+filetype.to_s+' '+mimetype.to_s, :target => '_self', :rel=> 'group', :id=>'fileinfo_'+attachment.id.to_s, :title => attachment.description.blank? ? attachment.filename.to_s : attachment.description.to_s -%>
  <% end %>
  <% if attachment.is_text? %>
    <%= link_to image_tag('magnifier.png'),
                :controller => 'attachments', :action => 'show',
                :id => attachment, :filename => attachment.filename %>
  <% end %>
  <% if options[:deletable] %>
    <%= link_to image_tag('delete.png'), attachment_path(attachment),
                                         :data => {:confirm => l(:text_are_you_sure)},
                                         :method => :delete,
                                         :class => 'delete',
                                         :title => l(:button_delete) %>
  <% end %>
  <span class="size">(<%= number_to_human_size attachment.filesize %>)</span>
  <% if options[:author] || !attachment.description.empty? %>
  <% file_information = ''
     file_information += '<div class="thumbnail">'+image_tag(url_for(attachment), :height=>"64px") + "</div>".html_safe if mimetype == 'image'
     file_information += '<i>'.html_safe+h(attachment.author)+', ' + format_time(attachment.created_on)+'</i>'.html_safe
     file_information += h(" #{attachment.description}")+'<br/>'.html_safe unless attachment.description.empty?
     javascriptString += 'addToolTip("#fileinfo_'+attachment.id.to_s+'",\''+file_information+'\');' %>
  <% end %>
</div>
<% end %>
<div style="display: none">
  <div tabindex="-1" style="width: 612px; height: 600px;" id="showPDF"></div>
</div>

<% if defined?(thumbnails) && thumbnails %>
  <% images = attachments.select(&:thumbnailable?) %>
  <% if images.any? %>
  <div class="thumbnails">
    <% images.each do |attachment| %>
      <div><%= thumbnail_tag(attachment) %></div>
    <% end %>
  </div>
  <% end %>
<% end %>
</div>

<% unless attachments[1].nil? %>
<%= javascript_tag '
  $(document).ready(function() {
    '+javascriptString+'
    var myPDF = new PDFObject({ url: "'+ url_for(attachments[1]).to_s()+"/"+attachments[1].filename.to_s() +'"}).embed("showPDF");
  });' 
%>
<%end%>

